{% extends "base.html" %}

{% block title %}Deal Flow Tracker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='layout.css') }}">
<style>
    .deal-flow-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 0.6rem 0.8rem;
        border-radius: 6px;
        color: white;
        margin-bottom: 0.5rem;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);
    }
    
    .deal-title-section h1 {
        font-size: 0.8rem;
        font-weight: 800;
        margin: 0 0 0.3rem 0;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }
    
    .deal-stats {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 0.3rem;
        margin-top: 0px;
    }
    
    .deal-stat-box {
        background: rgba(255, 255, 255, 0.18);
        padding: 0.3rem 0.4rem;
        border-radius: 4px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.25);
        transition: all 0.3s;
        text-align: center;
    }
    
    .deal-stat-box:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-1px);
    }
    
    .deal-stat-number {
        font-size: 0.6rem;
        font-weight: 800;
        margin-bottom: 0.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.15rem;
    }
    
    .deal-stat-label {
        font-size: 0.45rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        font-weight: 600;
    }
    
    .filters-bar {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .filter-btn {
        padding: 6px 12px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.6rem;
        transition: all 0.2s;
    }
    
    .filter-btn:hover {
        border-color: #667eea;
        background: #f7f9ff;
    }
    
    .filter-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }
    
    .deal-card {
        background: white;
        border-radius: 6px;
        padding: 0.4rem;
        margin-bottom: 0.4rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid #e8e8e8;
        border-left: 2px solid #667eea;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }
    
    .deal-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }
    
    .deal-card:hover {
        box-shadow: 0 8px 28px rgba(102, 126, 234, 0.15);
        transform: translateY(-3px);
        border-color: #667eea;
    }
    
    .deal-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.3rem;
    }
    
    .deal-title {
        font-size: 0.6rem;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 0.2rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .deal-year-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.15rem 0.3rem;
        border-radius: 6px;
        font-size: 0.5rem;
        font-weight: 700;
        letter-spacing: 0.3px;
    }
    
    .deal-parties {
        font-size: 0.55rem;
        color: #555;
        margin-bottom: 0.3rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        flex-wrap: wrap;
    }
    
    .party-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .party-arrow {
        color: #667eea;
        font-size: 12px;
        font-weight: 700;
    }
    
    .deal-status {
        padding: 0.2rem 0.4rem;
        border-radius: 8px;
        font-size: 0.55rem;
        font-weight: 600;
        text-align: center;
        min-width: 40px;
    }
    
    .status-completed {
        background: #e8f5e9;
        color: #2e7d32;
    }
    
    .status-ongoing {
        background: #fff3e0;
        color: #f57c00;
    }
    
    .status-rumored {
        background: #f3e5f5;
        color: #7b1fa2;
    }
    
    .status-milestone {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .deal-description {
        font-size: 0.6rem;
        line-height: 1.4;
        color: #555;
        margin-bottom: 0.3rem;
    }
    
    .deal-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 0.3rem;
        padding: 0.3rem;
        background: #f8f9fa;
        border-radius: 4px;
    }
    
    .deal-detail {
        display: flex;
        flex-direction: column;
    }
    
    .detail-label {
        font-size: 0.5rem;
        color: #666;
        margin-bottom: 0.1rem;
        text-transform: uppercase;
        font-weight: 600;
    }
    
    .detail-value {
        font-size: 0.65rem;
        font-weight: 700;
        color: #1a1a1a;
    }
    
    .sector-tag {
        display: inline-block;
        background: #e3f2fd;
        color: #1976d2;
        padding: 0.15rem 0.3rem;
        border-radius: 8px;
        font-size: 0.55rem;
        font-weight: 500;
        margin-right: 0.2rem;
    }
    
    .deal-type-tag {
        display: inline-block;
        background: #f3e5f5;
        color: #7b1fa2;
        padding: 0.15rem 0.3rem;
        border-radius: 8px;
        font-size: 0.55rem;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<!-- Deal Flow Header -->
<div class="deal-flow-header">
    <div class="deal-title-section">
        <h1><i class="fas fa-chart-network"></i> Deal Flow Tracker</h1>
    </div>
    
    <div class="deal-stats" id="dealStatsContainer">
        <div class="deal-stat-box">
            <div class="deal-stat-number">
                <i class="fas fa-handshake" style="font-size: 12px; opacity: 0.9;"></i>
                <span id="totalDeals">-</span>
            </div>
            <div class="deal-stat-label">Total Deals</div>
        </div>
        <div class="deal-stat-box">
            <div class="deal-stat-number">
                <i class="fas fa-check-circle" style="font-size: 12px; opacity: 0.9;"></i>
                <span id="completedDeals">-</span>
            </div>
            <div class="deal-stat-label">Completed</div>
        </div>
        <div class="deal-stat-box">
            <div class="deal-stat-number">
                <i class="fas fa-clock" style="font-size: 12px; opacity: 0.9;"></i>
                <span id="ongoingDeals">-</span>
            </div>
            <div class="deal-stat-label">Ongoing</div>
        </div>
        <div class="deal-stat-box">
            <div class="deal-stat-number">
                <i class="fas fa-robot" style="font-size: 12px; opacity: 0.9;"></i>
                <span id="aiDeals">-</span>
            </div>
            <div class="deal-stat-label">AI-Related</div>
        </div>
        <div class="deal-stat-box">
            <div class="deal-stat-number" id="totalValue">-</div>
            <div class="deal-stat-label">Total Value</div>
        </div>
        <div class="deal-stat-box">
            <div class="deal-stat-number">
                <i class="fas fa-star" style="font-size: 12px; opacity: 0.9;"></i>
                <span id="nordic2025">-</span>
            </div>
            <div class="deal-stat-label">Nordic 2025</div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="filters-bar">
    <span style="font-weight: 700; color: #333; margin-right: 10px;">Filter:</span>
    <button class="filter-btn active" data-filter="all"><i class="fas fa-list"></i> All Deals</button>
    <button class="filter-btn" data-filter="2025"><i class="fas fa-calendar-check"></i> 2025 Deals</button>
    <button class="filter-btn" data-filter="nordic"><i class="fas fa-flag"></i> Nordic Only</button>
    <button class="filter-btn" data-filter="pe"><i class="fas fa-briefcase"></i> Private Equity</button>
    <button class="filter-btn" data-filter="ai"><i class="fas fa-robot"></i> AI Deals</button>
    <button class="filter-btn" data-filter="funding"><i class="fas fa-rocket"></i> Funding Rounds</button>
    <button class="filter-btn" data-filter="megadeals"><i class="fas fa-gem"></i> Mega Deals ($5B+)</button>
    <button class="filter-btn" data-filter="completed"><i class="fas fa-check-circle"></i> Completed</button>
    <button class="filter-btn" data-filter="ongoing"><i class="fas fa-clock"></i> Ongoing</button>
</div>

<!-- Analytics Tabs -->
<div class="analytics-section" style="background: white; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <div class="analytics-tabs" style="display: flex; border-bottom: 2px solid #f0f0f0;">
        <button class="analytics-tab active" data-tab="deals" style="padding: 12px 18px; border: none; background: none; cursor: pointer; font-weight: 600; color: #667eea; border-bottom: 3px solid #667eea; font-size: 0.65rem;">
            <i class="fas fa-list"></i> Deal Flow
        </button>
        <button class="analytics-tab" data-tab="market-trends" style="padding: 12px 18px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; font-size: 0.65rem;">
            <i class="fas fa-chart-line"></i> Market Trends
        </button>
        <button class="analytics-tab" data-tab="country-analysis" style="padding: 12px 18px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; font-size: 0.65rem;">
            <i class="fas fa-flag"></i> Country Analysis
        </button>
        <button class="analytics-tab" data-tab="sector-analysis" style="padding: 12px 18px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; font-size: 0.65rem;">
            <i class="fas fa-industry"></i> Sector Analysis
        </button>
    </div>
    
    <!-- Deal Flow Tab Content -->
    <div id="tab-deals" class="analytics-content active">
        <div id="dealsContainer">
            <div style="text-align: center; padding: 60px; color: #999;">
                <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                <p style="font-size: 18px;">Loading deal flow...</p>
            </div>
        </div>
    </div>
    
    <!-- Market Trends Tab Content -->
    <div id="tab-market-trends" class="analytics-content" style="display: none; padding: 30px;">
        <div style="margin-bottom: 30px;">
            <h3 style="margin: 0 0 10px 0; color: #1a1a1a; font-size: 24px;">Nordic PE Market Trends</h3>
            <p style="color: #666; margin: 0;">Buyout vs VC deal volumes (2022 Q2 - 2025 Q2)</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-chart-bar" style="color: #6366F1;"></i>
                    Buyout Deal Volume
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 382 deals | LTM: 1,465 deals | +10% QoQ Growth
                </p>
                <canvas id="buyoutChart" style="max-height: 350px;"></canvas>
            </div>
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-chart-line" style="color: #3B82F6;"></i>
                    Venture Capital Deal Volume
                </h4>
                <p style="margin: 0 0 20px 0; color: #EF4444; font-size: 13px; font-weight: 600;">
                    Q2'25: 325 deals | LTM: 1,445 deals | -16% QoQ Decline
                </p>
                <canvas id="vcChart" style="max-height: 350px;"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Country Analysis Tab Content -->
    <div id="tab-country-analysis" class="analytics-content" style="display: none; padding: 30px;">
        <div style="margin-bottom: 30px;">
            <h3 style="margin: 0 0 10px 0; color: #1a1a1a; font-size: 24px;">Nordic Buyout Deal Volume by Country</h3>
            <p style="color: #666; margin: 0;">Q2 2025 vs Q1 2025 performance across Nordic markets</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <img src="https://flagcdn.com/w40/fi.png" width="28" height="21" alt="Finland" style="border-radius: 4px;"> Finland
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 67 deals | +20% QoQ Growth | 18% of Nordic deals
                </p>
                <canvas id="finlandChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <img src="https://flagcdn.com/w40/se.png" width="28" height="21" alt="Sweden" style="border-radius: 4px;"> Sweden
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 154 deals | +7% QoQ Growth | 40% of Nordic deals
                </p>
                <canvas id="swedenChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <img src="https://flagcdn.com/w40/no.png" width="28" height="21" alt="Norway" style="border-radius: 4px;"> Norway
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 81 deals | +35% QoQ Growth | 21% of Nordic deals
                </p>
                <canvas id="norwayChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <img src="https://flagcdn.com/w40/dk.png" width="28" height="21" alt="Denmark" style="border-radius: 4px;"> Denmark
                </h4>
                <p style="margin: 0 0 20px 0; color: #EF4444; font-size: 13px; font-weight: 600;">
                    Q2'25: 80 deals | -8% QoQ Decline | IT sector 41% of deals
                </p>
                <canvas id="denmarkChart" style="max-height: 280px;"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Sector Analysis Tab Content -->
    <div id="tab-sector-analysis" class="analytics-content" style="display: none; padding: 30px;">
        <div style="margin-bottom: 30px;">
            <h3 style="margin: 0 0 10px 0; color: #1a1a1a; font-size: 24px;">Nordic Buyout Deal Volume by Sector</h3>
            <p style="color: #666; margin: 0;">Tech grew significantly (+32%), Business Services grew moderately (+8%), Consumer & Retail declined substantially (-28%)</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">üè≠</span> Industrial Manufacturing
                </h4>
                <p style="margin: 0 0 20px 0; color: #6B7280; font-size: 13px; font-weight: 600;">
                    Q2'25: 54 deals | -4% QoQ | Stable near 3-year avg (60 deals)
                </p>
                <canvas id="industrialChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">üíª</span> Tech
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 115 deals | +32% QoQ Growth | Top: Software (35 deals)
                </p>
                <canvas id="techChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ü§ù</span> Business Services
                </h4>
                <p style="margin: 0 0 20px 0; color: #10B981; font-size: 13px; font-weight: 600;">
                    Q2'25: 220 deals | +8% QoQ Growth | Above 3-year avg (200)
                </p>
                <canvas id="businessServicesChart" style="max-height: 280px;"></canvas>
            </div>
            
            <div class="chart-card" style="background: white; padding: 25px; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;">
                <h4 style="margin: 0 0 8px 0; color: #1a1a1a; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">üõí</span> Consumer & Retail
                </h4>
                <p style="margin: 0 0 20px 0; color: #EF4444; font-size: 13px; font-weight: 600;">
                    Q2'25: 63 deals | -28% QoQ Decline | Below 3-year avg (80)
                </p>
                <canvas id="consumerChart" style="max-height: 280px;"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
let allDeals = [];
let currentFilter = 'all';

document.addEventListener('DOMContentLoaded', function() {
    loadDeals();
    setupFilters();
    setupAnalyticsTabs();
    initializeCharts();
});

async function loadDeals() {
    try {
        const response = await fetch('/api/deal-flow');
        const data = await response.json();
        
        if (data.success) {
            // Sort deals by date - newest first
            allDeals = data.deals.sort((a, b) => {
                const dateA = a.announcement_date || a.completion_date || '1900-01-01';
                const dateB = b.announcement_date || b.completion_date || '1900-01-01';
                return new Date(dateB) - new Date(dateA);
            });
            updateStats(allDeals);
            displayDeals(allDeals);
        }
    } catch (error) {
        console.error('Error loading deals:', error);
    }
}

function updateStats(deals) {
    document.getElementById('totalDeals').textContent = deals.length;
    document.getElementById('completedDeals').textContent = deals.filter(d => d.status === 'Completed').length;
    document.getElementById('ongoingDeals').textContent = deals.filter(d => d.status === 'Ongoing').length;
    document.getElementById('aiDeals').textContent = deals.filter(d => d.sector && d.sector.toLowerCase().includes('ai')).length;
    
    // Calculate total value (rough approximation for display)
    document.getElementById('totalValue').textContent = '$280B+';
    
    // Count Nordic 2025 deals
    const nordic2025 = deals.filter(d => d.year === 2025 && isNordicDeal(d)).length;
    document.getElementById('nordic2025').textContent = nordic2025;
}

function isNordicDeal(deal) {
    const nordicCountries = ['Sweden', 'Norway', 'Denmark', 'Finland', 'Iceland', 'Nordic', 'Nordics'];
    return nordicCountries.some(country => deal.geography && deal.geography.includes(country));
}

function setupFilters() {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentFilter = this.dataset.filter;
            applyFilter();
        });
    });
}

function applyFilter() {
    let filtered = allDeals;
    
    switch(currentFilter) {
        case 'all':
            filtered = allDeals;
            break;
            
        case '2025':
            filtered = allDeals.filter(d => d.year === 2025);
            break;
            
        case 'nordic':
            filtered = allDeals.filter(d => isNordicDeal(d));
            break;
            
        case 'pe':
            filtered = allDeals.filter(d => {
                const peTypes = ['Buyout', 'Public-to-Private', 'Secondary Buyout', 'Buy-and-Build', 'Carve-out', 'PE Exit'];
                return peTypes.includes(d.deal_type);
            });
            break;
            
        case 'ai':
            filtered = allDeals.filter(d => 
                (d.sector && d.sector.toLowerCase().includes('ai')) || 
                (d.description && d.description.toLowerCase().includes('ai'))
            );
            break;
            
        case 'funding':
            filtered = allDeals.filter(d => {
                const fundingTypes = ['Series A', 'Series B', 'Series C', 'Series D', 'Series E', 'Series F', 'Series G', 'Growth Capital', 'Seed Capital'];
                return fundingTypes.includes(d.deal_type);
            });
            break;
            
        case 'megadeals':
            filtered = allDeals.filter(d => {
                if (!d.deal_value) return false;
                const value = d.deal_value.toLowerCase();
                // Extract numeric value
                const match = value.match(/[\d.,]+/);
                if (!match) return false;
                const numValue = parseFloat(match[0].replace(',', ''));
                
                // Check if billion and >= 5
                if (value.includes('billion')) {
                    return numValue >= 5;
                }
                return false;
            });
            break;
            
        case 'completed':
            filtered = allDeals.filter(d => d.status === 'Completed');
            break;
            
        case 'ongoing':
            filtered = allDeals.filter(d => d.status === 'Ongoing');
            break;
            
        default:
            filtered = allDeals;
    }
    
    displayDeals(filtered);
}

function displayDeals(deals) {
    const container = document.getElementById('dealsContainer');
    
    if (deals.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 60px; color: #999;">
                <i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.3;"></i>
                <p style="font-size: 18px;">No deals match your filter</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    deals.forEach(deal => {
        html += createDealCard(deal);
    });
    
    container.innerHTML = html;
    
    // Convert emoji flags to images using Twemoji (for Windows compatibility)
    setTimeout(() => {
        if (typeof twemoji !== 'undefined') {
            document.querySelectorAll('.country-flag-emoji').forEach(el => {
                twemoji.parse(el, {
                    folder: 'svg',
                    ext: '.svg',
                    base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/'
                });
            });
        }
    }, 100);
}

function createDealCard(deal) {
    const statusClass = `status-${deal.status.toLowerCase().replace(/\s+/g, '-')}`;
    
    // Get country flags - different sizes for different locations
    const countryFlagLarge = getCountryFlag(deal.geography, 'medium');
    const countryFlagSmall = getCountryFlag(deal.geography, 'small');
    
    // Get company logos
    const acquirerLogo = getCompanyLogo(deal.acquirer);
    const targetLogo = getCompanyLogo(deal.target);
    
    // Check if 2025 deal
    const year2025Badge = deal.year === 2025 ? '<span class="deal-year-badge"><i class="fas fa-calendar-check"></i> 2025</span>' : '';
    
    const cardHTML = `
        <div class="deal-card">
            <div class="deal-card-header">
                <div style="flex: 1;">
                    <div class="deal-title">
                        ${deal.deal_name}
                        ${year2025Badge}
                    </div>
                    <div class="deal-parties">
                        <strong>Acquirer:</strong> ${deal.acquirer} ‚Üí 
                        <strong>Target:</strong> ${deal.target}
                    </div>
                    <div style="margin-top: 10px;">
                        <span class="sector-tag">${deal.sector}</span>
                        <span class="deal-type-tag">${deal.deal_type}</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="company-logos" style="display: flex; align-items: center; gap: 10px;">
                        ${acquirerLogo}
                        <span style="color: #999; font-size: 14px;">‚Üí</span>
                        ${targetLogo}
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${countryFlagLarge}
                            <div class="deal-status ${statusClass}">
                                ${getStatusIcon(deal.status)} ${deal.status}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="deal-description">
                ${deal.description}
            </div>
            
            <div class="deal-details">
                ${deal.deal_value && deal.deal_value !== 'N/A' && deal.deal_value !== 'Undisclosed' ? `
                <div class="deal-detail">
                    <div class="detail-label"><i class="fas fa-dollar-sign"></i> Deal Value</div>
                    <div class="detail-value">${deal.deal_value}</div>
                </div>
                ` : ''}
                
                <div class="deal-detail">
                    <div class="detail-label"><i class="fas fa-globe-europe"></i> Geography</div>
                    <div class="detail-value" style="display: flex; align-items: center;">${countryFlagSmall}${deal.geography}</div>
                </div>
                
                ${deal.announcement_date ? `
                <div class="deal-detail">
                    <div class="detail-label"><i class="fas fa-calendar-alt"></i> Announced</div>
                    <div class="detail-value">${deal.announcement_date}</div>
                </div>
                ` : ''}
                
                ${deal.completion_date ? `
                <div class="deal-detail">
                    <div class="detail-label"><i class="fas fa-calendar-check"></i> Completed</div>
                    <div class="detail-value">${deal.completion_date}</div>
                </div>
                ` : ''}
                
                ${deal.fund && deal.fund !== 'N/A' && deal.fund !== 'Multiple' ? `
                <div class="deal-detail">
                    <div class="detail-label"><i class="fas fa-briefcase"></i> Fund</div>
                    <div class="detail-value">${deal.fund}</div>
                </div>
                ` : ''}
            </div>
        </div>
    `;
    
    return cardHTML;
}

function getCountryFlag(geography, size = 'medium') {
    if (!geography) return size === 'small' ? '<span class="country-flag-emoji" style="display: inline-block; font-size: 16px; margin-right: 6px;">üåç</span>' : '<span class="country-flag-emoji" style="font-size: 22px;">üåç</span>';
    
    const geo = geography.toLowerCase();
    const fontSize = size === 'small' ? '16px' : '22px';
    const marginRight = size === 'small' ? ' margin-right: 6px;' : '';
    const display = size === 'small' ? ' display: inline-block;' : '';
    
    // Check for specific countries - using class for Twemoji parsing
    if (geo.includes('sweden') || geo.includes('swedish')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá∏üá™</span>`;
    if (geo.includes('norway') || geo.includes('norwegian')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá≥üá¥</span>`;
    if (geo.includes('denmark') || geo.includes('danish')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá©üá∞</span>`;
    if (geo.includes('finland') || geo.includes('finnish')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá´üáÆ</span>`;
    if (geo.includes('iceland')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üáÆüá∏</span>`;
    if (geo.includes('nordic') || geo.includes('scandinavia')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá™üá∫</span>`;
    if (geo.includes('europe')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üá™üá∫</span>`;
    if (geo.includes('global')) return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üåç</span>`;
    
    // Default for unknown
    return `<span class="country-flag-emoji" style="font-size: ${fontSize};${display}${marginRight}">üåç</span>`;
}

function getStatusIcon(status) {
    const iconMap = {
        'Completed': '<i class="fas fa-check-circle"></i>',
        'Ongoing': '<i class="fas fa-clock"></i>',
        'Rumored': '<i class="fas fa-question-circle"></i>',
        'Milestone': '<i class="fas fa-flag"></i>',
        'Failed': '<i class="fas fa-times-circle"></i>'
    };
    
    return iconMap[status] || '<i class="fas fa-circle"></i>';
}

function getCompanyLogo(companyName) {
    if (!companyName) return '';
    
    // Clean company name - remove parentheses and extra info
    const cleanName = companyName.split('(')[0].split('-')[0].split('/')[0].trim();
    
    // Try to get a known company logo first
    const directLogo = getKnownCompanyLogo(cleanName);
    
    // Create smart fallback with full company name for better initials
    const initials = cleanName.split(' ').slice(0, 2).join('+');
    const fallbackUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(initials)}&background=667eea&color=fff&size=48&bold=true&format=png&rounded=true`;
    
    return `
        <div class="company-logo" style="width: 40px; height: 40px; border-radius: 8px; overflow: hidden; border: 1px solid #e0e0e0; display: flex; align-items: center; justify-content: center; background: white; flex-shrink: 0;">
            <img src="${directLogo || fallbackUrl}" 
                 alt="${cleanName}"
                 onerror="this.src='${fallbackUrl}'"
                 style="width: 100%; height: 100%; object-fit: contain; padding: 3px;">
        </div>
    `;
}

function getKnownCompanyLogo(companyName) {
    const name = companyName.toLowerCase();
    
    // PE Firms - More comprehensive mapping
    const peFirms = {
        'eqt': 'https://logo.clearbit.com/eqtgroup.com',
        'nordic capital': 'https://logo.clearbit.com/nordiccapital.com',
        'altor': 'https://logo.clearbit.com/altor.com',
        'triton': 'https://logo.clearbit.com/triton-partners.com',
        'investor ab': 'https://logo.clearbit.com/investorab.com',
        'kinnevik': 'https://logo.clearbit.com/kinnevik.com',
        'industriv√§rden': 'https://logo.clearbit.com/industrivarden.se',
        'ratos': 'https://logo.clearbit.com/ratos.se',
        'litorina': 'https://logo.clearbit.com/litorina.se',
        'polaris': 'https://logo.clearbit.com/polarisequity.dk',
        'axcel': 'https://logo.clearbit.com/axcel.dk',
        'fsn capital': 'https://logo.clearbit.com/fsncapital.com',
        'verdane': 'https://logo.clearbit.com/verdane.com',
        'adelis': 'https://logo.clearbit.com/adelisequity.com',
        'blackstone': 'https://logo.clearbit.com/blackstone.com',
        'kkr': 'https://logo.clearbit.com/kkr.com',
        'carlyle': 'https://logo.clearbit.com/carlyle.com',
        'apollo': 'https://logo.clearbit.com/apollo.com',
        'bain capital': 'https://logo.clearbit.com/baincapital.com',
        'thoma bravo': 'https://logo.clearbit.com/thomabravo.com',
        'permira': 'https://logo.clearbit.com/permira.com',
        'warburg pincus': 'https://logo.clearbit.com/warburgpincus.com',
        'general atlantic': 'https://logo.clearbit.com/generalatlantic.com',
        'silver lake': 'https://logo.clearbit.com/silverlake.com'
    };
    
    // Check PE firms first
    for (const [firm, logo] of Object.entries(peFirms)) {
        if (name.includes(firm)) return logo;
    }
    
    // Well-known companies - Comprehensive database
    const knownCompanies = {
        // Nordic Tech & Unicorns
        'spotify': 'https://logo.clearbit.com/spotify.com',
        'klarna': 'https://logo.clearbit.com/klarna.com',
        'northvolt': 'https://logo.clearbit.com/northvolt.com',
        'rovio': 'https://logo.clearbit.com/rovio.com',
        'supercell': 'https://logo.clearbit.com/supercell.com',
        'wolt': 'https://logo.clearbit.com/wolt.com',
        'voi': 'https://logo.clearbit.com/voiscooters.com',
        'gelato': 'https://logo.clearbit.com/gelato.com',
        'kahoot': 'https://logo.clearbit.com/kahoot.com',
        'einride': 'https://logo.clearbit.com/einride.com',
        'budbee': 'https://logo.clearbit.com/budbee.com',
        'truecaller': 'https://logo.clearbit.com/truecaller.com',
        'storytel': 'https://logo.clearbit.com/storytel.com',
        'epidemic sound': 'https://logo.clearbit.com/epidemicsound.com',
        'polestar': 'https://logo.clearbit.com/polestar.com',
        'trustly': 'https://logo.clearbit.com/trustly.com',
        'mathem': 'https://logo.clearbit.com/mathem.se',
        
        // Swedish Industrials & Manufacturing
        'volvo': 'https://logo.clearbit.com/volvo.com',
        'atlas copco': 'https://logo.clearbit.com/atlascopco.com',
        'ericsson': 'https://logo.clearbit.com/ericsson.com',
        'electrolux': 'https://logo.clearbit.com/electrolux.com',
        'sandvik': 'https://logo.clearbit.com/sandvik.com',
        'scania': 'https://logo.clearbit.com/scania.com',
        'abb': 'https://logo.clearbit.com/abb.com',
        'skf': 'https://logo.clearbit.com/skf.com',
        'hexagon': 'https://logo.clearbit.com/hexagon.com',
        'alfa laval': 'https://logo.clearbit.com/alfalaval.com',
        
        // Telecom & Communications
        'telia': 'https://logo.clearbit.com/telia.com',
        'telenor': 'https://logo.clearbit.com/telenor.com',
        'tdc': 'https://logo.clearbit.com/tdc.dk',
        'sinch': 'https://logo.clearbit.com/sinch.com',
        'ice group': 'https://logo.clearbit.com/icegroup.com',
        
        // Danish Companies
        '√∏rsted': 'https://logo.clearbit.com/orsted.com',
        'orsted': 'https://logo.clearbit.com/orsted.com',
        'vestas': 'https://logo.clearbit.com/vestas.com',
        'novo nordisk': 'https://logo.clearbit.com/novonordisk.com',
        'novo holdings': 'https://logo.clearbit.com/novonordisk.com',
        'chr. hansen': 'https://logo.clearbit.com/chr-hansen.com',
        'chr hansen': 'https://logo.clearbit.com/chr-hansen.com',
        'maersk': 'https://logo.clearbit.com/maersk.com',
        'saxo bank': 'https://logo.clearbit.com/saxobank.com',
        'coloplast': 'https://logo.clearbit.com/coloplast.com',
        'carlsberg': 'https://logo.clearbit.com/carlsberg.com',
        'novozymes': 'https://logo.clearbit.com/novozymes.com',
        'genmab': 'https://logo.clearbit.com/genmab.com',
        'iss': 'https://logo.clearbit.com/issworld.com',
        'dsv': 'https://logo.clearbit.com/dsv.com',
        'pandora': 'https://logo.clearbit.com/pandora.net',
        'lego': 'https://logo.clearbit.com/lego.com',
        
        // Finnish Companies
        'nokia': 'https://logo.clearbit.com/nokia.com',
        'kone': 'https://logo.clearbit.com/kone.com',
        'fortum': 'https://logo.clearbit.com/fortum.com',
        'oura': 'https://logo.clearbit.com/ouraring.com',
        'swappie': 'https://logo.clearbit.com/swappie.com',
        'supercell': 'https://logo.clearbit.com/supercell.com',
        'w√§rtsil√§': 'https://logo.clearbit.com/wartsila.com',
        'wartsila': 'https://logo.clearbit.com/wartsila.com',
        'neste': 'https://logo.clearbit.com/neste.com',
        'konecranes': 'https://logo.clearbit.com/konecranes.com',
        'metso': 'https://logo.clearbit.com/metso.com',
        'upm': 'https://logo.clearbit.com/upm.com',
        'stora enso': 'https://logo.clearbit.com/storaenso.com',
        
        // Norwegian Companies
        'equinor': 'https://logo.clearbit.com/equinor.com',
        'yara': 'https://logo.clearbit.com/yara.com',
        'autostore': 'https://logo.clearbit.com/autostoresystem.com',
        'vipps': 'https://logo.clearbit.com/vipps.no',
        'norsk hydro': 'https://logo.clearbit.com/hydro.com',
        'orkla': 'https://logo.clearbit.com/orkla.com',
        'mowi': 'https://logo.clearbit.com/mowi.com',
        'tomra': 'https://logo.clearbit.com/tomra.com',
        'freyr': 'https://logo.clearbit.com/freyrbattery.com',
        
        // Swedish Retail & Consumer
        'h&m': 'https://logo.clearbit.com/hm.com',
        'ikea': 'https://logo.clearbit.com/ikea.com',
        'axfood': 'https://logo.clearbit.com/axfood.se',
        'ica': 'https://logo.clearbit.com/ica.se',
        'coop': 'https://logo.clearbit.com/coop.se',
        'granng√•rden': 'https://logo.clearbit.com/granngarden.se',
        'granngarden': 'https://logo.clearbit.com/granngarden.se',
        
        // Healthcare & Pharma
        'zeus': 'https://logo.clearbit.com/zeusinc.com',
        'zeus company': 'https://logo.clearbit.com/zeusinc.com',
        'catalent': 'https://logo.clearbit.com/catalent.com',
        'lundbeck': 'https://logo.clearbit.com/lundbeck.com',
        'medtronic': 'https://logo.clearbit.com/medtronic.com',
        'astrazeneca': 'https://logo.clearbit.com/astrazeneca.com',
        'getinge': 'https://logo.clearbit.com/getinge.com',
        'mentice': 'https://logo.clearbit.com/mentice.com',
        'humana': 'https://logo.clearbit.com/humana.se',
        'bioinvent': 'https://logo.clearbit.com/bioinvent.com',
        'addlife': 'https://logo.clearbit.com/addlife.com',
        'kry': 'https://logo.clearbit.com/kry.se',
        'min doktor': 'https://logo.clearbit.com/mindoktor.se',
        'tandem health': 'https://logo.clearbit.com/tandemhealth.com',
        
        // Building & Industrial Services
        'assemblin': 'https://logo.clearbit.com/assemblin.com',
        'caverion': 'https://logo.clearbit.com/caverion.com',
        'ahlsell': 'https://logo.clearbit.com/ahlsell.com',
        'inwido': 'https://logo.clearbit.com/inwido.com',
        'coor': 'https://logo.clearbit.com/coor.com',
        'elfa': 'https://logo.clearbit.com/elfa.com',
        'instalco': 'https://logo.clearbit.com/instalco.se',
        'wallenius wilhelmsen': 'https://logo.clearbit.com/wallwil.com',
        'dahl': 'https://logo.clearbit.com/dahl.no',
        'ragn-sells': 'https://logo.clearbit.com/ragnsells.com',
        
        // Software & Tech
        'visma': 'https://logo.clearbit.com/visma.com',
        'sinch': 'https://logo.clearbit.com/sinch.com',
        'squarespace': 'https://logo.clearbit.com/squarespace.com',
        'dayforce': 'https://logo.clearbit.com/dayforce.com',
        'quinyx': 'https://logo.clearbit.com/quinyx.com',
        'scrive': 'https://logo.clearbit.com/scrive.com',
        'bisnode': 'https://logo.clearbit.com/bisnode.com',
        'macrobond': 'https://logo.clearbit.com/macrobond.com',
        'penneo': 'https://logo.clearbit.com/penneo.com',
        'planacy': 'https://logo.clearbit.com/planacy.com',
        
        // AI & Deep Tech
        'sana': 'https://logo.clearbit.com/sana.ai',
        'legora': 'https://logo.clearbit.com/legora.com',
        'kognic': 'https://logo.clearbit.com/kognic.com',
        'rerun': 'https://logo.clearbit.com/rerun.io',
        'validio': 'https://logo.clearbit.com/validio.io',
        'normative': 'https://logo.clearbit.com/normative.io',
        'scape': 'https://logo.clearbit.com/scape.io',
        'intuicell': 'https://logo.clearbit.com/intuicell.com',
        'listen labs': 'https://logo.clearbit.com/listenlabs.ai',
        'aris machina': 'https://logo.clearbit.com/arismachina.com',
        'terra labs': 'https://logo.clearbit.com/terralabs.io',
        'freda': 'https://logo.clearbit.com/freda.ai',
        'superb ai': 'https://logo.clearbit.com/superb-ai.com',
        
        // Financial Services
        'doordash': 'https://logo.clearbit.com/doordash.com',
        'discover': 'https://logo.clearbit.com/discover.com',
        'capital one': 'https://logo.clearbit.com/capitalone.com',
        'blackrock': 'https://logo.clearbit.com/blackrock.com',
        'sony': 'https://logo.clearbit.com/sony.com',
        'gilion': 'https://logo.clearbit.com/gilion.co',
        'quartr': 'https://logo.clearbit.com/quartr.com',
        
        // Energy & CleanTech
        'h2 green steel': 'https://logo.clearbit.com/h2greensteel.com',
        'ekkio': 'https://logo.clearbit.com/ekkio.com',
        'santos': 'https://logo.clearbit.com/santos.com',
        'origin energy': 'https://logo.clearbit.com/originenergy.com.au',
        'nipsco': 'https://logo.clearbit.com/nisource.com',
        'ninedot': 'https://logo.clearbit.com/ninedotenergy.com',
        'air france': 'https://logo.clearbit.com/airfrance.com',
        'aeromexico': 'https://logo.clearbit.com/aeromexico.com',
        
        // Retail & E-commerce
        'zalando': 'https://logo.clearbit.com/zalando.com',
        'home depot': 'https://logo.clearbit.com/homedepot.com',
        'srs distribution': 'https://logo.clearbit.com/srs.com',
        'morrisons': 'https://logo.clearbit.com/morrisons.com',
        'dustin': 'https://logo.clearbit.com/dustin.com',
        
        // Tech Infrastructure
        'ingram micro': 'https://logo.clearbit.com/ingrammicro.com',
        'telecom italia': 'https://logo.clearbit.com/telecomitalia.com',
        'eltel': 'https://logo.clearbit.com/eltelnetworks.com',
        'osttra': 'https://logo.clearbit.com/osttra.com',
        'inteliquent': 'https://logo.clearbit.com/inteliquent.com',
        
        // Enterprise Software
        'powerschool': 'https://logo.clearbit.com/powerschool.com',
        'pluralsight': 'https://logo.clearbit.com/pluralsight.com',
        'darktrace': 'https://logo.clearbit.com/darktrace.com',
        'thoughtworks': 'https://logo.clearbit.com/thoughtworks.com',
        'suse': 'https://logo.clearbit.com/suse.com',
        'waystar': 'https://logo.clearbit.com/waystar.com',
        'navan': 'https://logo.clearbit.com/navan.com',
        'tripactions': 'https://logo.clearbit.com/navan.com',
        
        // Media & Entertainment
        'axel springer': 'https://logo.clearbit.com/axelspringer.com',
        'caa': 'https://logo.clearbit.com/caa.com',
        'endeavor': 'https://logo.clearbit.com/endeavor.com',
        'wme': 'https://logo.clearbit.com/wmeagency.com',
        'todaytix': 'https://logo.clearbit.com/todaytix.com',
        'secret cinema': 'https://logo.clearbit.com/secretcinema.org',
        'formula 1': 'https://logo.clearbit.com/formula1.com',
        'f1': 'https://logo.clearbit.com/formula1.com',
        
        // Healthcare Services & Devices
        'hologic': 'https://logo.clearbit.com/hologic.com',
        'verisure': 'https://logo.clearbit.com/verisure.com',
        'helping hand': 'https://logo.clearbit.com/helpinghand.org.au',
        'moment group': 'https://logo.clearbit.com/momentgruppen.se',
        'vertica': 'https://logo.clearbit.com/verticacare.com',
        
        // Industrial Distribution & Services
        'kaman': 'https://logo.clearbit.com/kaman.com',
        'tricon': 'https://logo.clearbit.com/triconresidential.com',
        'fraikin': 'https://logo.clearbit.com/fraikin.com',
        'anticimex': 'https://logo.clearbit.com/anticimex.com',
        'stada': 'https://logo.clearbit.com/stada.com',
        'karo healthcare': 'https://logo.clearbit.com/karo.se',
        'norican': 'https://logo.clearbit.com/norican.com',
        'envirotainer': 'https://logo.clearbit.com/envirotainer.com',
        
        // Food & Consumer Products
        'orkla': 'https://logo.clearbit.com/orkla.com',
        'br√∂dernas': 'https://logo.clearbit.com/brodernas.se',
        'brodernas': 'https://logo.clearbit.com/brodernas.se',
        'swedish match': 'https://logo.clearbit.com/swedishmatch.com',
        
        // Shipping & Logistics
        'havyard': 'https://logo.clearbit.com/havyard.com',
        
        // Defense & Aerospace
        'anduril': 'https://logo.clearbit.com/anduril.com',
        
        // Global Investment Firms & Banks
        'goldman sachs': 'https://logo.clearbit.com/goldmansachs.com',
        'morgan stanley': 'https://logo.clearbit.com/morganstanley.com',
        'jpmorgan': 'https://logo.clearbit.com/jpmorganchase.com',
        'bank of america': 'https://logo.clearbit.com/bankofamerica.com',
        'citigroup': 'https://logo.clearbit.com/citigroup.com',
        'softbank': 'https://logo.clearbit.com/softbank.com',
        'sequoia': 'https://logo.clearbit.com/sequoiacap.com',
        'andreessen horowitz': 'https://logo.clearbit.com/a16z.com',
        'a16z': 'https://logo.clearbit.com/a16z.com',
        'accel': 'https://logo.clearbit.com/accel.com',
        'benchmark': 'https://logo.clearbit.com/benchmark.com',
        'greylock': 'https://logo.clearbit.com/greylock.com',
        'iconiq': 'https://logo.clearbit.com/iconiqcapital.com',
        'tiger global': 'https://logo.clearbit.com/tigerglobal.com',
        'insight partners': 'https://logo.clearbit.com/insightpartners.com',
        'tpg': 'https://logo.clearbit.com/tpg.com',
        'vista equity': 'https://logo.clearbit.com/vistaequitypartners.com',
        'thoma bravo': 'https://logo.clearbit.com/thomabravo.com',
        'menlo ventures': 'https://logo.clearbit.com/menlovc.com',
        'lightspeed': 'https://logo.clearbit.com/lsvp.com',
        'atomico': 'https://logo.clearbit.com/atomico.com',
        'northzone': 'https://logo.clearbit.com/northzone.com',
        'creandum': 'https://logo.clearbit.com/creandum.com',
        'lakestar': 'https://logo.clearbit.com/lakestar.com',
        'balderton': 'https://logo.clearbit.com/balderton.com',
        'village global': 'https://logo.clearbit.com/villageglobal.vc',
        'y combinator': 'https://logo.clearbit.com/ycombinator.com',
        
        // Global Tech Companies
        'microsoft': 'https://logo.clearbit.com/microsoft.com',
        'google': 'https://logo.clearbit.com/google.com',
        'amazon': 'https://logo.clearbit.com/amazon.com',
        'meta': 'https://logo.clearbit.com/meta.com',
        'facebook': 'https://logo.clearbit.com/meta.com',
        'apple': 'https://logo.clearbit.com/apple.com',
        'nvidia': 'https://logo.clearbit.com/nvidia.com',
        'samsung': 'https://logo.clearbit.com/samsung.com',
        'ibm': 'https://logo.clearbit.com/ibm.com',
        'oracle': 'https://logo.clearbit.com/oracle.com',
        'salesforce': 'https://logo.clearbit.com/salesforce.com',
        
        // Automotive
        'volkswagen': 'https://logo.clearbit.com/volkswagen.com',
        'bmw': 'https://logo.clearbit.com/bmw.com',
        'mercedes': 'https://logo.clearbit.com/mercedes-benz.com',
        'mercedes-benz': 'https://logo.clearbit.com/mercedes-benz.com',
        'tesla': 'https://logo.clearbit.com/tesla.com',
        'ford': 'https://logo.clearbit.com/ford.com',
        'general motors': 'https://logo.clearbit.com/gm.com',
        'toyota': 'https://logo.clearbit.com/toyota.com',
        'sega': 'https://logo.clearbit.com/sega.com',
        
        // Real Estate & Services
        'liberty media': 'https://logo.clearbit.com/libertymedia.com',
        'philip morris': 'https://logo.clearbit.com/pmi.com',
        'ares': 'https://logo.clearbit.com/aresmgmt.com',
        'ares management': 'https://logo.clearbit.com/aresmgmt.com',
        'oaktree': 'https://logo.clearbit.com/oaktreecapital.com',
        'brookfield': 'https://logo.clearbit.com/brookfield.com',
        'cvc': 'https://logo.clearbit.com/cvc.com',
        'mari': 'https://logo.clearbit.com/wmeagency.com',
        
        // Additional PE Portfolio Companies
        'bisnode': 'https://logo.clearbit.com/bisnode.com',
        'talentium': 'https://logo.clearbit.com/talentium.com',
        'nebula': 'https://logo.clearbit.com/nebula.fi',
        'superside': 'https://logo.clearbit.com/superside.com',
        'industry ventures': 'https://logo.clearbit.com/industryventures.com',
        'global infrastructure partners': 'https://logo.clearbit.com/global-infra.com',
        'gip': 'https://logo.clearbit.com/global-infra.com',
        
        // Recent 2025 Deal Companies
        'bavarian nordic': 'https://logo.clearbit.com/bavarian-nordic.com',
        'waters': 'https://logo.clearbit.com/waters.com',
        'waters corporation': 'https://logo.clearbit.com/waters.com',
        'becton dickinson': 'https://logo.clearbit.com/bd.com',
        'bd': 'https://logo.clearbit.com/bd.com',
        'smartsheet': 'https://logo.clearbit.com/smartsheet.com',
        'marshall': 'https://logo.clearbit.com/marshallheadphones.com',
        'marshall group': 'https://logo.clearbit.com/marshallheadphones.com',
        'hongshan': 'https://logo.clearbit.com/hongshancap.com',
        'sequoia china': 'https://logo.clearbit.com/sequoiacap.com',
        'northwind': 'https://logo.clearbit.com/northwindmidstream.com',
        'mplx': 'https://logo.clearbit.com/mplx.com',
        'marathon': 'https://logo.clearbit.com/marathonpetroleum.com',
        'eco material': 'https://logo.clearbit.com/ecomaterial.com',
        'crh': 'https://logo.clearbit.com/crh.com',
        'one equity': 'https://logo.clearbit.com/oneequity.com',
        'hbc': 'https://logo.clearbit.com/hbc-insurance.de',
        'casepoint': 'https://logo.clearbit.com/casepoint.com',
        'opexus': 'https://logo.clearbit.com/opexus.com',
        'gemspring': 'https://logo.clearbit.com/gemspring.com',
        'henry schein': 'https://logo.clearbit.com/henryschein.com',
        
        // More PE Firms
        'summa equity': 'https://logo.clearbit.com/summaequity.com',
        'capman': 'https://logo.clearbit.com/capman.com',
        'bridgefield': 'https://logo.clearbit.com/bridgefieldcapital.com',
        'investindustrial': 'https://logo.clearbit.com/investindustrial.com',
        'five point': 'https://logo.clearbit.com/fivepointcapital.com',
        'advent': 'https://logo.clearbit.com/adventinternational.com',
        'cinven': 'https://logo.clearbit.com/cinven.com',
        'pai partners': 'https://logo.clearbit.com/paipartners.com',
        'apax': 'https://logo.clearbit.com/apax.com',
        'hg capital': 'https://logo.clearbit.com/hgcapital.com',
        'capvest': 'https://logo.clearbit.com/capvest.com',
        'platinum equity': 'https://logo.clearbit.com/platinumequity.com',
        'cd&r': 'https://logo.clearbit.com/cdr-inc.com',
        'clayton dubilier': 'https://logo.clearbit.com/cdr-inc.com'
    };
    
    for (const [company, logo] of Object.entries(knownCompanies)) {
        if (name.includes(company)) return logo;
    }
    
    // Fallback to UI Avatars for unknown companies
    return null;
}

// Analytics Tab Functions
function setupAnalyticsTabs() {
    document.querySelectorAll('.analytics-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabId = this.dataset.tab;
            
            // Update tab styles
            document.querySelectorAll('.analytics-tab').forEach(t => {
                t.style.color = '#666';
                t.style.borderBottom = '3px solid transparent';
            });
            this.style.color = '#667eea';
            this.style.borderBottom = '3px solid #667eea';
            
            // Show/hide content
            document.querySelectorAll('.analytics-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`tab-${tabId}`).style.display = 'block';
            
            // Initialize charts when tab becomes visible
            if (tabId !== 'deals') {
                setTimeout(() => {
                    initializeCharts();
                }, 100);
            }
        });
    });
}

function initializeCharts() {
    // Market Trends Charts
    createBuyoutChart();
    createVCChart();
    
    // Country Analysis Charts
    createFinlandChart();
    createSwedenChart();
    createNorwayChart();
    createDenmarkChart();
    
    // Sector Analysis Charts
    createIndustrialChart();
    createTechChart();
    createBusinessServicesChart();
    createConsumerChart();
}

// Market Trends Charts
function createBuyoutChart() {
    const ctx = document.getElementById('buyoutChart');
    if (!ctx || ctx.chart) return;
    
    const quarterlyData = [456, 324, 337, 374, 357, 325, 318, 358, 364, 356, 380, 347, 382];
    const ltmData = [1635, 1611, 1521, 1491, 1392, 1393, 1374, 1358, 1365, 1396, 1458, 1447, 1465];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Quarterly Deal Volume',
                data: quarterlyData,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, '#6366F1');
                    gradient.addColorStop(0.5, '#7C3AED');
                    gradient.addColorStop(1, '#5B21B6');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false,
                yAxisID: 'y'
            }, {
                label: 'LTM Aggregate',
                data: ltmData,
                type: 'line',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderColor: '#10B981',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#10B981',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: { size: 12, weight: '600' },
                        padding: 15,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'Quarterly Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'LTM Aggregate',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: {
                        drawOnChartArea: false,
                    }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createVCChart() {
    const ctx = document.getElementById('vcChart');
    if (!ctx || ctx.chart) return;
    
    const quarterlyData = [579, 458, 544, 677, 436, 395, 400, 560, 434, 346, 388, 386, 325];
    const ltmData = [2327, 2323, 2263, 2258, 2115, 2052, 1908, 1791, 1789, 1740, 1728, 1554, 1445];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Quarterly Deal Volume',
                data: quarterlyData,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, '#3B82F6');
                    gradient.addColorStop(0.5, '#2563EB');
                    gradient.addColorStop(1, '#1E40AF');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false,
                yAxisID: 'y'
            }, {
                label: 'LTM Aggregate',
                data: ltmData,
                type: 'line',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                borderColor: '#10B981',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#10B981',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: { size: 12, weight: '600' },
                        padding: 15,
                        usePointStyle: true
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'Quarterly Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'LTM Aggregate',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: {
                        drawOnChartArea: false,
                    }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

// Country Analysis Charts
function createFinlandChart() {
    const ctx = document.getElementById('finlandChart');
    if (!ctx || ctx.chart) return;
    
    const data = [84, 51, 55, 74, 69, 50, 55, 60, 59, 71, 60, 56, 67];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Finland Deal Volume',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#6366F1');
                    gradient.addColorStop(0.5, '#7C3AED');
                    gradient.addColorStop(1, '#5B21B6');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createSwedenChart() {
    const ctx = document.getElementById('swedenChart');
    if (!ctx || ctx.chart) return;
    
    const data = [178, 137, 143, 168, 153, 139, 162, 144, 161, 156, 159, 144, 154];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Sweden Deal Volume',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#10B981');
                    gradient.addColorStop(0.5, '#059669');
                    gradient.addColorStop(1, '#047857');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createNorwayChart() {
    const ctx = document.getElementById('norwayChart');
    if (!ctx || ctx.chart) return;
    
    const data = [81, 74, 60, 59, 77, 59, 49, 78, 72, 65, 89, 60, 81];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Norway Deal Volume',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#3B82F6');
                    gradient.addColorStop(0.5, '#2563EB');
                    gradient.addColorStop(1, '#1E40AF');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createDenmarkChart() {
    const ctx = document.getElementById('denmarkChart');
    if (!ctx || ctx.chart) return;
    
    const data = [113, 62, 79, 73, 58, 77, 52, 76, 72, 64, 72, 87, 80];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Denmark Deal Volume',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#8B5CF6');
                    gradient.addColorStop(0.5, '#7C3AED');
                    gradient.addColorStop(1, '#6D28D9');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

// Sector Analysis Charts
function createIndustrialChart() {
    const ctx = document.getElementById('industrialChart');
    if (!ctx || ctx.chart) return;
    
    const data = [88, 60, 55, 66, 54, 54, 57, 58, 56, 59, 66, 56, 54];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Industrial Manufacturing',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#6366F1');
                    gradient.addColorStop(0.5, '#7C3AED');
                    gradient.addColorStop(1, '#5B21B6');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createTechChart() {
    const ctx = document.getElementById('techChart');
    if (!ctx || ctx.chart) return;
    
    const data = [148, 85, 100, 98, 106, 112, 83, 103, 96, 88, 124, 87, 115];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Tech',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#10B981');
                    gradient.addColorStop(0.5, '#059669');
                    gradient.addColorStop(1, '#047857');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createBusinessServicesChart() {
    const ctx = document.getElementById('businessServicesChart');
    if (!ctx || ctx.chart) return;
    
    const data = [228, 172, 180, 206, 207, 169, 173, 193, 223, 217, 213, 204, 220];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Business Services',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#3B82F6');
                    gradient.addColorStop(0.5, '#2563EB');
                    gradient.addColorStop(1, '#1E40AF');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}

function createConsumerChart() {
    const ctx = document.getElementById('consumerChart');
    if (!ctx || ctx.chart) return;
    
    const data = [110, 78, 73, 88, 73, 73, 79, 79, 64, 83, 84, 88, 63];
    const labels = ['Q2\'22', 'Q3\'22', 'Q4\'22', 'Q1\'23', 'Q2\'23', 'Q3\'23', 'Q4\'23', 'Q1\'24', 'Q2\'24', 'Q3\'24', 'Q4\'24', 'Q1\'25', 'Q2\'25'];
    
    ctx.chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Consumer & Retail',
                data: data,
                backgroundColor: function(context) {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                    gradient.addColorStop(0, '#8B5CF6');
                    gradient.addColorStop(0.5, '#7C3AED');
                    gradient.addColorStop(1, '#6D28D9');
                    return gradient;
                },
                borderRadius: 12,
                borderWidth: 0,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.85)',
                    padding: 12,
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Deals',
                        font: { size: 11, weight: '600' }
                    },
                    ticks: { 
                        font: { size: 10 }
                    },
                    grid: { color: '#f3f4f6' }
                },
                x: {
                    ticks: { font: { size: 10, weight: '600' } },
                    grid: { display: false }
                }
            }
        }
    });
}
</script>

<!-- Chart.js for analytics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- Twemoji for flag rendering -->
<script src="https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>
{% endblock %}
